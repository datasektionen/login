# Login

Lives at `login2.datasektionen.se`. Uses [CAS](https://en.wikipedia.org/wiki/Central_Authentication_Service) to talk with https://login.kth.se. Fetches user info from KTH ldap at ldap.kth.se:389.

## Endpoints

### /hello

Returns `"Hello Login!"`.

### /login?callback=...

Must be called with parameter `callback` set to a url.

After the user has authenticated, the server will redirect to `callback` with a random token appended at the end.

### /logout

Logs a user out.

### /verify/<token>?api_key=...

Can be used to verify that a user is logged in. Supply the token generated by `/login` in the path and a valid `api_key` and the server will answer with who the token belongs to. The response will be in JSON with the following format:

```json
{
    "first_name": "...",
    "last_name": "...",
    "user": "...",
    "emails": "...",
    "ugkthid": "..." # NOTE: on the form u1xxxxx
}
```

An `api_key` can be created using `genkey.py`. A [pls](https://github.com/datasektionen/pls) api token can also be used.

## Dev setup

First install [docker](https://docs.docker.com/get-docker/) and [docker-compose](https://docs.docker.com/compose/install/). Then run:

```sh
[sudo] docker-compose up
```

The webserver will be available at [http://localhost:8000](http://localhost:8000).

To access the db directly run:

```sh
[sudo] docker-compose exec db psql --username=postgres
```

To generate an `api_key` using `genkey.py` run:

```sh
[sudo] docker-compose exec web pipenv run python genkey.py <keyname>
```

These test users exist:

- juland
- tanlar
- gopgus

They all have the password: `rudolf`.
